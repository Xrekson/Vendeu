<div class="auction-details-container" *ngIf="auction">
  <!-- Back Navigation -->
  <div class="navigation-bar">
    <button mat-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Listings
    </button>
  </div>

  <div class="auction-content">
    <!-- Auction Title -->
    <div class="auction-header">
      <h1 class="auction-title">{{ auction.name }}</h1>
      <div class="auction-meta">
        <mat-chip [color]="getAuctionStatusColor()" selected>
          {{ getAuctionStatus() }}
        </mat-chip>
        <span class="time-remaining" *ngIf="isAuctionActive && timeRemaining !== 'Auction ended'">
          <mat-icon>schedule</mat-icon>
          {{ timeRemaining }}
        </span>
        <span class="time-remaining ended" *ngIf="!isAuctionActive">
          <mat-icon>event_busy</mat-icon>
          Auction ended
        </span>
      </div>
    </div>

    <mat-divider></mat-divider>

    <!-- Main Content Grid -->
    <div class="main-grid">
      <!-- Left Column - Images -->
      <div class="image-section">
        <mat-card class="image-card">
          <app-carousel
            [products]="carouselImages"
            [autoSlide]="false"
            [showIndicators]="true"
            [showNavigation]="true"
            [showThumbnails]="true"
            [height]="'500px'"
            [borderRadius]="'8px'"
          >
          </app-carousel>
          
          <!-- Image Counter -->
          <div class="image-counter">
            <span class="counter-text">
              {{ selectedImageIndex + 1 }} / {{ carouselImages.length }}
            </span>
          </div>
        </mat-card>
      </div>

      <!-- Right Column - Auction Details -->
      <div class="details-section">
        <!-- Auction Timeline -->
        <mat-card class="timeline-card">
          <mat-card-header>
            <mat-card-title>Auction Timeline</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-stepper [linear]="false" orientation="vertical">
              <mat-step label="Auction Started">
                <div class="step-content">
                  <mat-icon>play_circle</mat-icon>
                  <div class="step-details">
                    <span class="step-title">Started</span>
                    <span class="step-time">{{ formatDate(auction.auction_start) }}</span>
                  </div>
                </div>
              </mat-step>
              
              <mat-step label="Current Status">
                <div class="step-content">
                  <mat-icon>schedule</mat-icon>
                  <div class="step-details">
                    <span class="step-title">{{ getAuctionStatus() }}</span>
                    <span class="step-time">{{ timeRemaining }}</span>
                  </div>
                </div>
              </mat-step>
              
              <mat-step label="Auction Ends">
                <div class="step-content">
                  <mat-icon>stop_circle</mat-icon>
                  <div class="step-details">
                    <span class="step-title">Ends</span>
                    <span class="step-time">{{ formatDate(auction.auction_end) }}</span>
                  </div>
                </div>
              </mat-step>
            </mat-stepper>

            <!-- Progress Bar -->
            <div class="progress-section">
              <div class="progress-info">
                <span>Time Progress</span>
                <span>{{ auctionProgress.toFixed(1) }}%</span>
              </div>
              <mat-progress-bar 
                mode="determinate" 
                [value]="auctionProgress"
                color="primary"
              ></mat-progress-bar>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Bid Information -->
        <mat-card class="bid-info-card">
          <mat-card-header>
            <mat-card-title>Bid Information</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <mat-list>
              <mat-list-item>
                <mat-icon matListItemIcon>attach_money</mat-icon>
                <div matListItemTitle>Starting Price</div>
                <div matListItemLine>{{ formatCurrency(auction.price) }}</div>
              </mat-list-item>
              
              <mat-list-item>
                <mat-icon matListItemIcon>trending_up</mat-icon>
                <div matListItemTitle>Current Highest Bid</div>
                <div matListItemLine [class.high-bid]="auction.highestbid > 0">
                  {{ auction.highestbid > 0 ? formatCurrency(auction.highestbid) : 'No bids yet' }}
                </div>
              </mat-list-item>
              
              <mat-list-item>
                <mat-icon matListItemIcon>add_circle</mat-icon>
                <div matListItemTitle>Bid Increment</div>
                <div matListItemLine>{{ formatCurrency(auction.priceInterval) }}</div>
              </mat-list-item>
              
              <mat-list-item>
                <mat-icon matListItemIcon>arrow_upward</mat-icon>
                <div matListItemTitle>Minimum Next Bid</div>
                <div matListItemLine class="min-bid">
                  {{ formatCurrency(minBid) }}
                </div>
              </mat-list-item>
            </mat-list>
          </mat-card-content>
        </mat-card>

        <!-- Bid Placement (Only if auction is active) -->
        @if (isAuctionActive) {
          <mat-card class="bid-placement-card">
            <mat-card-header>
              <mat-card-title>Place Your Bid</mat-card-title>
            </mat-card-header>
            <mat-card-content>
              <div class="bid-input-section">
                <div class="bid-controls">
                  <button 
                    mat-icon-button 
                    color="primary" 
                    (click)="decrementBid()"
                    [disabled]="bidAmount <= minBid"
                  >
                    <mat-icon>remove</mat-icon>
                  </button>
                  
                  <mat-form-field appearance="outline" class="bid-input">
                    <mat-label>Bid Amount</mat-label>
                    <input 
                      matInput 
                      type="number"
                      [(ngModel)]="bidAmount"
                      [min]="minBid"
                      [step]="auction.priceInterval"
                      #bidInput
                    />
                    <span matTextPrefix>$</span>
                  </mat-form-field>
                  
                  <button 
                    mat-icon-button 
                    color="primary" 
                    (click)="incrementBid()"
                  >
                    <mat-icon>add</mat-icon>
                  </button>
                </div>
                
                <div class="bid-actions">
                  <button 
                    mat-raised-button 
                    color="primary" 
                    class="bid-button"
                    (click)="placeBid()"
                    [disabled]="!bidAmount || bidAmount < minBid"
                  >
                    <mat-icon>gavel</mat-icon>
                    Place Bid
                  </button>
                  
                  <button 
                    mat-stroked-button 
                    color="primary"
                    (click)="bidAmount = minBid"
                  >
                    Set Minimum
                  </button>
                </div>
                
                <div class="bid-hint">
                  <mat-icon>info</mat-icon>
                  <span>Minimum bid: {{ formatCurrency(minBid) }}</span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        }

        <!-- Item Details -->
        <mat-card class="details-card">
          <mat-card-header>
            <mat-card-title>Item Details</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="details-content">
              <p>{{ auction.detail }}</p>
              
              <!-- Additional Details -->
              @if (auction.category || auction.condition || auction.location) {
                <mat-divider class="details-divider"></mat-divider>
                
                <div class="additional-details">
                  @if (auction.category) {
                    <div class="detail-item">
                      <mat-icon>category</mat-icon>
                      <div>
                        <span class="detail-label">Category</span>
                        <span class="detail-value">{{ auction.category }}</span>
                      </div>
                    </div>
                  }
                  
                  @if (auction.condition) {
                    <div class="detail-item">
                      <mat-icon>construction</mat-icon>
                      <div>
                        <span class="detail-label">Condition</span>
                        <span class="detail-value">{{ auction.condition }}</span>
                      </div>
                    </div>
                  }
                  
                  @if (auction.location) {
                    <div class="detail-item">
                      <mat-icon>location_on</mat-icon>
                      <div>
                        <span class="detail-label">Location</span>
                        <span class="detail-value">{{ auction.location }}</span>
                      </div>
                    </div>
                  }
                </div>
              }
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Bids History Tab -->
    @if (bidsHistory.length > 0) {
      <mat-card class="bids-history-card">
        <mat-card-header>
          <mat-card-title>Bids History</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <mat-list>
            @for (bid of bidsHistory; track bid.time) {
              <mat-list-item class="bid-history-item">
                <mat-icon matListItemIcon>account_circle</mat-icon>
                <div matListItemTitle>{{ bid.bidder }}</div>
                <div matListItemLine>{{ formatDate(bid.time) }}</div>
                <div matListItemMeta class="bid-amount">
                  {{ formatCurrency(bid.amount) }}
                </div>
              </mat-list-item>
            }
          </mat-list>
        </mat-card-content>
      </mat-card>
    }
  </div>
</div>

<!-- Loading State -->
@if (!auction) {
  <div class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading auction details...</p>
  </div>
}